flowchart TD
    A([Start: Run Script]) --> B[Load Configuration & Paths]
    B --> C{Input File Exists?}
    C -- No --> Z1[Log Error: Input file missing\nStop Execution]
    C -- Yes --> D[Read Input CSV]
    D --> E{Required Columns Present?}
    E -- No --> Z2[Log Error: Missing columns\nStop Execution]
    E -- Yes --> F[For Each Molecule:\nCheck for Missing Data]
    F --> G{Missing Data?}
    G -- Yes --> G1[Log Warning: Missing data\nExclude Molecule]
    G -- No --> H[Count Rule Violations: Lipinski, Ghose, Veber, Egan, Muegge]
    H --> I{Violations > MAX_VIOLATIONS_ALLOWED?}
    I -- Yes --> I1[Log Info: Filtered out\nExclude Molecule]
    I -- No --> I2[Retain Molecule]
    G1 --> J[Next Molecule]
    I1 --> J
    I2 --> J
    J --> K{All Molecules Processed?}
    K -- No --> F
    K -- Yes --> L[Write Filtered Data to Output CSV\nUnique filename if needed]
    L --> M[Log Output File Write]
    M --> N[Generate Summary Report\nStats, Distribution, Rule Counts]
    N --> O[Log Summary & Save Report]
    O --> P([End: Success])
    Z1 --> Q([End: Failure])
    Z2 --> Q

    %% Styling for clarity
    classDef error fill:#ffcccc,stroke:#d33,stroke-width:2;
    classDef warn fill:#fff3cd,stroke:#e6b800,stroke-width:2;
    classDef process fill:#e6f7ff,stroke:#3399cc,stroke-width:2;
    class Z1,Z2,Q error;
    class G1 warn;
    class B,D,F,H,L,M,N,O process;
